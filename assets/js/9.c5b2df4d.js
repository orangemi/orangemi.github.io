(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{214:function(e,n,a){"use strict";a.r(n);var r=a(2),s=Object(r.a)({},function(){var e=this,n=e.$createElement,a=e._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"记录一次-macos-nginx无法访问的情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#记录一次-macos-nginx无法访问的情况","aria-hidden":"true"}},[e._v("#")]),e._v(" 记录一次 MacOS nginx无法访问的情况")]),e._v(" "),a("p",[e._v("PS. 以后要多写一些自己的内容")]),e._v(" "),a("p",[e._v("在本地开发环境中，如果需要用nginx反向代理自己的一些服务，通常用于处理跨域问题。今天发现在请求nginx大体积文件时在浏览器中显示请求"),a("code",[e._v("failed")]),e._v(", 在控制台会发生"),a("code",[e._v("net::ERR_SPDY_PROTOCOL_ERROR 200")]),e._v("的报错。")]),e._v(" "),a("p",[e._v("怀疑nginx或者原服务有问题，直接在命令行curl原有服务，发现没有问题，但在curl nginx服务中发现，请求断了。google了一会儿没有找到原因，无奈开启了nginx error日志，发现以下内容：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('2019/05/05 11:55:55 [crit] 25909#0: *1 open() "/usr/local/var/run/nginx/proxy_temp/1/00/0000000001" failed (13: Permission denied) while reading upstream, client: 127.0.0.1, server: some_server, request: "GET /app.js HTTP/1.1", upstream: "http://127.0.0.1:9011/app.js", host: "some_host"\n2019/05/05 12:04:19 [error] 26087#0: *1 kevent() reported that connect() failed (61: Connection refused) while connecting to upstream, client: 127.0.0.1, server: some_server, request: "GET /app.js HTTP/1.1", upstream: "http://[::1]:9011/app.js", host: "some_host"\n')])])]),a("p",[e._v("仔细调查了"),a("code",[e._v("/usr/local/var/run/nginx")]),e._v("的目录:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ ls -l /usr/local/var/run/nginx\ntotal 0\ndrwx------   2 nobody  admin   64 Jun  4  2017 client_body_temp\ndrwx------   2 nobody  admin   64 Jun  4  2017 fastcgi_temp\ndrwx------  12 nobody  admin  384 Jun 11  2017 proxy_temp\ndrwx------   2 nobody  admin   64 Jun  4  2017 scgi_temp\ndrwx------   2 nobody  admin   64 Jun  4  2017 uwsgi_temp\n")])])]),a("p",[e._v("再看到自己的nginx进程:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ ps aux | grep nginx\nSomeUser           25941   0.0  0.0  4320356   2572   ??  Ss   11:56AM   0:00.01 nginx: master process nginx\nSomeUser           26264   0.0  0.0  4337260   3568   ??  S    12:05PM   0:00.08 nginx: worker process\n")])])]),a("p",[e._v("这里解释一下，"),a("code",[e._v("/usr/local/var/run")]),e._v("运行时的临时目录里有用户组混乱的场景，主要是因为"),a("code",[e._v("nginx")]),e._v("启动时使用的是mac用户，如果使用高权限启动就没有这个问题了。")]),e._v(" "),a("p",[e._v("所以解决方案有2个：")]),e._v(" "),a("h2",{attrs:{id:"方案1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方案1","aria-hidden":"true"}},[e._v("#")]),e._v(" 方案1")]),e._v(" "),a("p",[e._v("仍然使用mac用户启动nginx，但需要修改运行时临时目录权限：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("chown -R SomeUser: /usr/local/var/run/nginx/*\n")])])]),a("h2",{attrs:{id:"方案2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方案2","aria-hidden":"true"}},[e._v("#")]),e._v(" 方案2")]),e._v(" "),a("p",[e._v("使用超级用户启动nginx，但需要修复运行时临时目录权限：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("chown -R nobody:admin /usr/local/var/run/nginx/*\n# 超级用户启动，那worker就是nobody了\nsudo nginx\n")])])])])},[],!1,null,null,null);n.default=s.exports}}]);